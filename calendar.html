<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendar / Schedule</title>
  <link href="https://fonts.googleapis.com/css2?family=Bruno+Ace&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: #000;
      color: white;
      font-family: 'Bruno Ace', cursive;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Toggle container */
    .toggle-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 25px;
      flex-direction: column;
    }

    .toggle {
      width: 220px;
      height: 70px;
      background: #434343;
      border-radius: 50px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: 0.4s ease;
      display: flex;
      align-items: center;
    }

    .circle {
      width: 55px;
      height: 55px;
      background: #B90101;
      border-radius: 50%;
      position: absolute;
      left: 8px;
      transition: all 0.4s ease;
    }

    .toggle.active .circle {
      left: 157px;
    }

    .toggle-labels {
      display: flex;
      justify-content: space-between;
      width: 220px;
      margin-top: 6px;
      font-size: 15px;
    }

    /* Default label colors on load */
    #calLabel {
      color: #FFD54A;
    }

    #schLabel {
      color: #555;
    }

    /* Sliding transition container */
    .view-container {
      position: relative;
      width: 100%;
      flex: 1;
      overflow: hidden;
    }

    .slide-view {
      position: absolute;
      width: 100%;
      top: 0;
      left: 0;
      transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
    }

    .hidden-view {
      opacity: 0;
      pointer-events: none;
    }

    .slide-left {
      transform: translateX(-100%);
    }

    .slide-right {
      transform: translateX(100%);
    }

    /* Day Navigation */
    .day-nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
    }

    .day-btn {
      background: #222;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      color: white;
      transition: 0.2s;
    }

    .day-btn.active {
      background: #B90101;
      color: white;
    }

    /* Schedule */
    .schedule {
      padding: 15px;
      padding-bottom: 70px;
    }

    .class-card {
      background: #434343;
      border-radius: 12px;
      padding: 12px 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .class-title {
      font-size: 16px;
      font-weight: bold;
    }

    .class-time {
      font-size: 14px;
      color: #aaa;
    }

    .class-card.access {
      background: #FAC903;
      color: black;
      font-weight: bold;
    }

    .class-card.access .class-time {
      color: black;
    }

    /* Calendar view */
    .calendar-container {
      background: #434343;
      border-radius: 20px;
      padding: 30px;
      margin: 20px auto;
      width: 90%;
      max-width: 800px;
      text-align: center;
      box-sizing: border-box;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .calendar-header h2 {
      font-size: 1.6rem;
      margin: 5px 0;
    }

    .calendar button {
      background: #B90101;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.3s;
    }

    .calendar button:hover {
      background: #FFD54A;
      color: black;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
    }

    .day {
      background: #000000;
      border-radius: 10px;
      padding: 18px 0;
      cursor: pointer;
      color: white;
      font-size: 16px;
      transition: 0.2s;
      position: relative;
    }

    .day:hover {
      background: #2b2b2b;
    }

    .today {
      background: #B90101;
      color: white;
      font-weight: bold;
    }

    .event-marker {
      width: 8px;
      height: 8px;
      background: #FFD54A;
      border-radius: 50%;
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.6);
      z-index: 2000;
    }

    .hidden {
      display: none;
    }

    .modal-content {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 340px;
      color: white;
      border: 2px solid #FFD54A;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      animation: popIn 0.25s ease forwards;
    }

    @keyframes popIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    textarea {
      width: 100%;
      height: 90px;
      resize: none;
      border-radius: 6px;
      padding: 8px;
      background: #000;
      color: #fff;
      border: 1px solid #444;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 12px 0;
      border-top: 1px solid #333;
    }

    .bottom-nav a {
      position: relative;
      text-decoration: none;
      color: #aaa;
      font-size: 28px;
      flex: 1;
      text-align: center;
    }

    .bottom-nav a.active::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 55px;
      height: 55px;
      background: #363636ff;
      border: 2px solid #ffffff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      z-index: -1;
    }

    .bottom-nav a.active {
      color: #FFD54A;
    }

    @media (max-width: 600px) {
      .calendar-container { width: 95%; padding: 15px; }
      .calendar { gap: 5px; }
      .day { padding: 12px 0; font-size: 14px; }
      .calendar-header h2 { font-size: 1.2rem; }
    }
  </style>
</head>
<body>

  <div class="toggle-container">
    <div class="toggle" id="viewToggle">
      <div class="circle"></div>
    </div>
    <div class="toggle-labels">
      <span id="calLabel">Calendar</span>
      <span id="schLabel">Schedule</span>
    </div>
  </div>

  <!-- Sliding container -->
  <div class="view-container">
    <div id="calendarContainer" class="slide-view">
      <div class="calendar-container">
        <div class="calendar-header">
          <button id="prev">‚óÄ</button>
          <h2 id="month-year"></h2>
          <button id="next">‚ñ∂</button>
        </div>
        <div id="calendar" class="calendar"></div>
      </div>
    </div>

    <div id="scheduleView" class="slide-view hidden-view slide-right">
      <div class="day-nav" id="dayNav">
        <div class="day-btn active" onclick="showSchedule('mon')">MON</div>
        <div class="day-btn" onclick="showSchedule('tue')">TUE</div>
        <div class="day-btn" onclick="showSchedule('wed')">WED</div>
        <div class="day-btn" onclick="showSchedule('thu')">THU</div>
        <div class="day-btn" onclick="showSchedule('fri')">FRI</div>
      </div>
      <div id="schedule" class="schedule"></div>
    </div>
  </div>

  <!-- Modal -->
  <div id="eventModal" class="modal hidden">
    <div class="modal-content">
      <h3 id="modal-date"></h3>
      <textarea id="eventInput" placeholder="Add assignment or event..."></textarea>
      <div style="margin-top:8px;">
        <button id="saveEvent">Save</button>
        <button id="closeModal">Cancel</button>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <a href="homepage.html">üè†</a>
    <a href="calendar.html" class="active">üìÖ</a>
    <a href="notes.html">üìù</a>
    <a href="clock.html">‚è∞</a>
    <a href="profile.html">üë§</a>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCD6MqOQtkVlGuhfMQTMxLl226_9coEU9k",
    authDomain: "omnium-2ebd2.firebaseapp.com",
    projectId: "omnium-2ebd2",
    storageBucket: "omnium-2ebd2.firebasestorage.app",
    messagingSenderId: "816486376253",
    appId: "1:816486376253:web:6433e7e3d3f584ab919b54",
    measurementId: "G-GWSKVGQP21"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let events = {};
  let userDocRef = null;

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    userDocRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userDocRef);
    const userData = userSnap.exists() ? userSnap.data() : {};
    events = userData.events || {};

    renderCalendar();
  });

  // --- Existing Schedule Setup ---
  const standardSchedule = [
    { name: "Period 1", time: "07:25 - 08:12" },
    { name: "Period 2", time: "08:17 - 09:13" },
    { name: "Period 3", time: "09:18 - 10:05" },
    { name: "Period 4", time: "10:10 - 10:57" },
    { name: "Period 5", time: "11:02 - 11:49" },
    { name: "Period 6", time: "11:54 - 12:41" },
    { name: "Period 7", time: "12:46 - 13:33" },
    { name: "Period 8", time: "13:38 - 14:25" }
  ];
  const wednesdaySchedule = [
    { name: "Access", time: "07:25 - 07:55" },
    { name: "Period 1", time: "08:00 - 08:41" },
    { name: "Period 2", time: "08:46 - 09:29" },
    { name: "Period 3", time: "09:34 - 10:15" },
    { name: "Period 4", time: "10:20 - 11:01" },
    { name: "Period 5", time: "11:06 - 11:47" },
    { name: "Period 6", time: "11:52 - 12:33" },
    { name: "Period 7", time: "12:38 - 01:19" },
    { name: "Period 8", time: "01:24 - 02:05" }
  ];
  const schedules = { mon: standardSchedule, tue: standardSchedule, wed: wednesdaySchedule, thu: standardSchedule, fri: standardSchedule };

// --- Schedule Fix ---
const dayButtons = document.querySelectorAll(".day-btn");
const dayNames = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];

function showSchedule(day) {
  // Remove active class from all buttons
  dayButtons.forEach(btn => btn.classList.remove("active"));
  
  // Find and activate the clicked button
  const clickedBtn = Array.from(dayButtons).find(b => b.textContent.toLowerCase() === day.slice(0,3));
  if (clickedBtn) clickedBtn.classList.add("active");

  // Render the schedule
  const scheduleDiv = document.getElementById("schedule");
  scheduleDiv.innerHTML = "";

  if (schedules[day]) {
    schedules[day].forEach(cls => {
      const div = document.createElement("div");
      div.classList.add("class-card");
      if (cls.name === "Access") div.classList.add("access");
      div.innerHTML = `
        <div class="class-title">${cls.name}</div>
        <div class="class-time">${cls.time}</div>
      `;
      scheduleDiv.appendChild(div);
    });
  }
}

// Bind click events dynamically
dayButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const day = btn.textContent.toLowerCase();
    showSchedule(day);
  });
});

// --- Auto-show current weekday ---
const todayIndex = new Date().getDay(); // 0 = Sun, 1 = Mon, etc.
const todayDay = dayNames[todayIndex];

// If it's Saturday or Sunday, default to Monday
const startDay = ["sat", "sun"].includes(todayDay) ? "mon" : todayDay;

showSchedule(startDay);

  // --- Calendar ---
  const calendar = document.getElementById("calendar");
  const monthYear = document.getElementById("month-year");
  let currentDate = new Date();

  const eventModal = document.getElementById("eventModal");
  const modalDate = document.getElementById("modal-date");
  const eventInput = document.getElementById("eventInput");
  const saveEvent = document.getElementById("saveEvent");
  const closeModal = document.getElementById("closeModal");
  let selectedDate = null;

  function renderCalendar() {
    calendar.innerHTML = "";
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    monthYear.textContent = `${monthNames[month]} ${year}`;
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < firstDay; i++) calendar.appendChild(document.createElement("div"));

    for (let day = 1; day <= daysInMonth; day++) {
      const dayDiv = document.createElement("div");
      dayDiv.classList.add("day");
      dayDiv.textContent = day;
      const dateKey = `${year}-${month + 1}-${day}`;
      const today = new Date();

      if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear())
        dayDiv.classList.add("today");

      if (events[dateKey]) {
        const marker = document.createElement("div");
        marker.classList.add("event-marker");
        dayDiv.appendChild(marker);
      }

      dayDiv.addEventListener("click", () => {
        selectedDate = dateKey;
        modalDate.textContent = `${monthNames[month]} ${day}, ${year}`;
        eventInput.value = events[dateKey] || "";
        eventModal.classList.remove("hidden");
        eventInput.focus();
      });

      calendar.appendChild(dayDiv);
    }
  }

  saveEvent.addEventListener("click", async () => {
    if (!selectedDate) return;
    const text = eventInput.value.trim();
    if (text) events[selectedDate] = text;
    else delete events[selectedDate];

    if (userDocRef) {
      await setDoc(userDocRef, { events }, { merge: true });
    }

    eventModal.classList.add("hidden");
    selectedDate = null;
    renderCalendar();
  });

  closeModal.addEventListener("click", () => {
    selectedDate = null;
    eventModal.classList.add("hidden");
  });

  document.getElementById("prev").addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  document.getElementById("next").addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  renderCalendar();

  // --- Slide Toggle ---
  const toggle = document.getElementById("viewToggle");
  const calLabel = document.getElementById("calLabel");
  const schLabel = document.getElementById("schLabel");
  const calendarView = document.getElementById("calendarContainer");
  const scheduleView = document.getElementById("scheduleView");

  toggle.addEventListener("click", () => {
    toggle.classList.toggle("active");
    if (toggle.classList.contains("active")) {
      calendarView.classList.add("slide-left", "hidden-view");
      scheduleView.classList.remove("slide-right", "hidden-view");
      calLabel.style.color = "#555";
      schLabel.style.color = "#FFD54A";
    } else {
      calendarView.classList.remove("slide-left", "hidden-view");
      scheduleView.classList.add("slide-right", "hidden-view");
      calLabel.style.color = "#FFD54A";
      schLabel.style.color = "#555";
    }
  });
</script>

</body>
</html>
